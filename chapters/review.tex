\newpage
\begin{center}
	\textbf{\large 1. АНАЛИТИЧЕСКИЙ ОБЗОР}
\end{center}
\refstepcounter{chapter}
\addcontentsline{toc}{chapter}{1. АНАЛИТИЧЕСКИЙ ОБЗОР ЛИТЕРАТУРЫ}

\newcommand{\divg}{\mathop{\mathrm{div}}\nolimits}
\newcommand{\rot}{\mathop{\mathrm{rot}}\nolimits}
\newcommand{\Ree}{\mathrm{Re}}
\newcommand{\Imm}{\mathrm{Im}}

\section{Историческая справка}

Явление полного внутреннего отражения -- основной эффект, благодаря которому свет распространяется по оптическому волноводу, -- хорошо изучено и описано ещё в XIX веке.
Несмотря на это, идея об оптоволокне как о новой среде передачи информации, зародилась только в 1950-е годы~\cite{hecht2004city}, а производство оптоволокна началось в 1960-е.
Самые первые волокна имели чудовищные помехи (loss более чем $1000$ Дб/км), однако, к середине 1970-х помехи в новом кварцевом оптоволокне сократились до 20 Дб/км.

Дальнейшее развитие технологий производства волокон позволили в 1979 вывести потери до более приемлемых 0.2 Дб/км для длины волны, равной 1.55 мкм~\cite{doi:10.1049/el:19790077}.
Создание кварцевых волокон стимулировало развитие нелинейной оптики: в 1972 году был сформулирован новый подход к изучению процессов рассеяния Рамана и Бриллюэна, началось исследование фазовой самомодуляции и состоялось экспериментальное открытие оптических солитонов в 1980 году.

Новый <<бум>> в теории оптических волокон начался в 1990-е годы, когда были изобретены усилители, легированные эрбием.
Эти усилители работали в спектральном диапазоне около $1.55$ мкм, что позволило значительно увеличить длину оптоволоконных кабелей~\cite{agrawal2007nonlinear}.

В последнее время наибольшие усилия сосредоточены не на усовершенствовании производственных процессов, а на интеллектуальной обработке оптических сигналов, которая позволяет наиболее эффективно компенсировать эффекты, от которых никак не избавиться даже в идеальных волноводах.
Кроме развитых спектральных методов, таких как SSFM~\cite{sinkin2003optimization}, в последние годы активно развивается PBM подходы, основанные на вариации не только малого нелинейного параметра $\gamma$, но и показателя GVD дисперсии $\beta$~\cite{Oliari2020},
однако, наиболее популярной в последнее время темой является оптимизация параметризованного SSFM с помощью методов машинного обучения~\cite{hager2018, hager2020}.

\section{Характеристики оптоволокна}

В простейшем случае оптоволокно состоит из центральной стеклянной сердцевины, окружённой оболочкой, показатель преломления которой $n_2$ немного меньше показателя преломления сердцевины $n_1$.
Говорят, что такие волокна имеют ступенчатый профиль преломления, чтобы отличать их от волокон с градиентным профилем (показатель преломления от сердцевины к оболочке постепенно уменьшается).
Мы будем рассматривать далее оптоволокно со ступенчатым профилем преломления.

Два важных параметра, характеризующих данное оптоволокно, это относительная разность показателей преломления:

\begin{equation}
	\Delta = \frac{n_1 - n_2}{n_1},
\end{equation}

и нормированная частота $V$, которая определяется так~\cite{buck2004fundamentals}:

\begin{equation}
	V = k_0 a \sqrt{n_1^2 - n_2^2},
\end{equation}

где $k_0 = {2\pi}/{\lambda}$, $a$ -- радиус сердцевины, $\lambda$ -- длина световой волны. Вывод параметра $V$ будет в аналитическом обзоре ниже.
Там же будет показано, что $V$-коэффициент определяет количество мод, поддерживаемых оптоволокном. Мы будем работать с одномодовым волокном (SMF), для которого $V<2.405$.
Обычно SMF имеет радиус $a < 5$ мкм и параметр $\Delta \approx 0.003$~\cite{agrawal2007nonlinear}.
Сердцевину SMF синтезируют на основе Si$O_2$ молекул, так что её принято называть кварцевой~\cite{agrawal2007nonlinear}.

\section{Затухание (attenuation)}

Коэффициент затухания $\alpha$ описывает то, как быстро уменьшается мощность светового сигнала при передаче в оптоволокне.
Пусть $P_0$ это мощность на передатчике (TX) в начале светового кабеля длиной $L$, а $P_T$ -- мощность, принятая получателем (RX) в конце кабеля ($P_T$).
Тогда затухание хорошо описывается уравнением Мальтуса

\begin{equation}
	\frac{dP_T}{dt} = -\alpha P_T, \,\,\, P(0) = P_0
\end{equation}

Отсюда имеем соотношение:

\begin{equation}
	P_T = P_0 \exp{(-\alpha L)}
\end{equation}

Вообще говоря, затухание в оптоволокне зависит от длины волны света.
Как видно из Рисунка 3.1 ниже, наименьшее затухание будет при длине оптического импульса около 1.5 мкм~\cite{li1985optical}.
Такой график потерь связан с поглощением кварца, рэлеевским рассеянием, пропорциональным $\alpha_R = c_R / \lambda^4$~\cite{TSUJIKAWA200074}.

\begin{figure}[!h]
	\begin{center}
		\includegraphics[width=300pt]{1.png}
		\caption{Пунктирная линия -- теоретическое затухание, основанное на рэлеевском рассеянии. Сплошная -- реальная ситуация в кварцевом SMF~\cite{li1985optical}.}
		\label{nmp}
	\end{center}
\end{figure}

\section{Хроматическая дисперсия (CD)}

Как показывает опыт~\cite{agrawal2007nonlinear}, показатель преломления оптоволокна зависит от длины волны светового импульса: $n(\omega)$.
Хорошее приближение показателя преломления можно получить, используя формулу Зельмайера~\cite{marcuse1991theory}

\begin{equation}
	n^2(\omega) = 1 + \sum_{j=1}^m \frac{B_j\omega_j^2}{\omega_j^2 - \omega^2},
\end{equation}

где $B_j$, $\omega_j$ и $m$ -- эмпирически определяемые параметры.
Для кварцевого SMF эти коэффициенты посчитаны ещё в 1960-е годы~\cite{Malitson:65}.

\begin{figure}[!h]
	\begin{center}
		\includegraphics[width=350pt]{2.png}
		\caption{Зависимость показателя преломления $n$ и группового индекса $n_g$ для разных длин световых импульсов в SMF~\cite{agrawal2007nonlinear}.}
		\label{nmp}
	\end{center}
\end{figure}

Все дисперсионные эффекты содержатся в разложении Тейлора постоянной распространения моды $\beta(\omega)$:

\begin{equation}
	\beta(\omega) = n(\omega) \frac{\omega}{c} = \beta_0 + \beta_1 (\omega - \omega_0) + \frac{1}{2} \beta_2 (\omega - \omega_0)^2 + \ldots
\end{equation}

Коэффициенты $\beta_1$ и $\beta_2$ связаны с групповой скоростью $v_g$ и показателем преломления следующим образом~\cite{agrawal2007nonlinear}:

\begin{equation}
	\beta_1 = \frac{1}{v_g} = \frac{n_g}{c} = \frac{1}{c}\left( n + \omega \frac{dn}{d\omega} \right)
\end{equation}

\begin{equation}
	\beta_2 = \frac{1}{c}\left(2 \frac{dn}{d\omega} + \omega \frac{d^2n}{d\omega^2} \right)
\end{equation}

Таким образом, коэффициент $\beta_2$ ответственен за GVD дисперсию (кратко опишем физическую суть явления: световой луч является квазимонохроматическим, для разных длин волн несколько разные показатели преломления, следовательно, на приёмник попадает более <<расползшийся>> импульс)

\section{Нелинейные эффекты}

В сильном электромагнитном поле (создаваемое мощными лазерами, передающими сигналы на длинных трассах), отзыв диэлектрической среды становится нелинейным.
Возникновение этого явления связано с ангармоническим движением связанных электронов при воздействии приложенного поля $\mathbf{E}$.
Результирующая поляризация $\mathbf{P}$ является уже не линейной, а удовлетворяющей соотношению:

\begin{equation}
	P = \varepsilon_0 \left( \chi_1 E + \chi_2 E^2 + \chi_3 E^3 + \ldots \right)
\end{equation}

В случае линейной поляризации при небольшой мощности импульса какую-либо значимую роль играет только линейная восприимчивость $\chi_1$.
Она определяет показатель преломления $n$ и константу затухания~\cite{agrawal2007nonlinear}.

Восприимчивость второго порядка $\chi_2$ определяет такие нелинейные эффекты, как генерация второй гармоники.
Следует иметь в виду, что данная гармоника ненулевая только для сред без центра осевой симметрии.
Так как кварцевая сердцевина волокна имеет ось симметрии, то восприимчивость $\chi_2 = 0$~\cite{buck2004fundamentals}.

Нелинейная восприимчивость третьего порядка $\chi_3$ ответственна за возникновение четырехволнового смешения, фазовой самомодуляции и фазовой кросс-модуляции~\cite{Igumenov2023}.

\section{Волновое уравнение}

Поскольку свет имеет электромагнитную природу, запишем уравнения Максвелла для оптического волновода в следующем виде~\cite{diament1990wave}:

% Магнитных зарядов в природе нет

\begin{equation}
	\divg \mathbf{B} = 0
\end{equation}

% Электрический ток порождает электрическую индукцию

\begin{equation}
	\divg \mathbf{D} = \rho
\end{equation}

% Электрический ток и изменение электрической индукции порождают вихревое магнитное поле

\begin{equation}
	\rot \mathbf{H} = \mathbf{j} + \frac{\partial \mathbf{D}}{\partial t}
\end{equation}

% Изменение магнитной индукции порождает вихревое электрическое поле

\begin{equation}
	\rot \mathbf{E} = - \frac{\partial \mathbf{B}}{\partial t}
\end{equation}

Здесь $\mathbf{E}$ и $\mathbf{H}$ -- электрическое и магнитное (векторные) поля, а $\mathbf{D}$ и $\mathbf{B}$ -- электрическая и магнитная индукции соответственно.

В такой среде, как оптическое волокно, свободные заряды отсутствуют (так называемый диэлектрик), так что электрический ток и заряд нулевые: $\mathbf{j} = 0$, $\rho = 0$.

Материальные уравнение для электрической и магнитной индукций запишем так:

\begin{equation}
	\mathbf{D} = \varepsilon_0 \mathbf{E} + \mathbf{P}
\end{equation}

\begin{equation}
	\mathbf{B} = \mu_0 \mathbf{H} + \mathbf{M}
\end{equation}

Здесь $\varepsilon_0$ и $\mu_0$ это электрическая и магнитная постоянные, а $\mathbf{P}$ и $\mathbf{M}$ -- векторы поляризации. Для оптоволокна, которое является немагнитной (не намагниченной) средой, поляризация $\mathbf{M} = 0$. Имеем:

\begin{equation}
	\rot{\left( \rot \mathbf{E} \right)} = - \frac{1}{c^2} \frac{\partial^2 \mathbf{E}}{\partial t^2} - \mu_0 \frac{\partial^2 \mathbf{P}}{\partial t^2},
\end{equation}

где $c$ -- скорость света, связанная соотношением $\varepsilon_0 \mu_0 = 1/c$. Чтобы получить волновое уравнение, нам нужно установить связь между поляризацией $P$ и электрическим полем $E$.
Линейная часть поляризации равна (при общей связи $\mathbf{P} = \mathbf{P}_{L} + \mathbf{P}_{NL}$):

\begin{equation}
	\mathbf{P}_L(\mathbf{r}, t) = \varepsilon_0 \int \limits_{-\infty}^{t} \chi_1 \left( \mathbf{r}, t - \xi \right) \mathbf{E}(\mathbf{r}, \xi) \, d\xi
\end{equation}

В этой и следующей главе мы не будем учитывать эффект нелинейной поляризации $\mathbf{P}_{NL}$ (поскольку он гораздо меньше линейного), однако дальше она сыграет важную роль в изложении материала. Итак, в частотной области:

\begin{equation}
	\mathbf{P}(\mathbf{r}, \omega) = \varepsilon_0 \int \widetilde{\chi_1} (\mathbf{r}, \omega) \cdot \widetilde{\mathbf{E}}(\mathbf{r}, \omega)
\end{equation}

Перепишем соотношение, полученное выше, в частотной области:

\begin{equation}
	\rot{\left( \rot \mathbf{\widetilde{E}}(\mathbf{r}, \omega) \right)} = \varepsilon(\omega) \frac{\omega^2}{c^2} \mathbf{\widetilde{E}}(\mathbf{r}, \omega),
\end{equation}

где $\mathbf{\widetilde{E}}(\mathbf{r}, \omega)$ это преобразование Фурье $\mathbf{E}(\mathbf{r}, t)$, определённое как

\begin{equation}
	\mathbf{\widetilde{E}}(\mathbf{r}, \omega) = \int \limits_{\mathbb{R}} \mathbf{E}(\mathbf{r}, t) \exp{(i \omega t)} \, dt
\end{equation}

Диэлектрическую константу в частотной области определим как:

\begin{equation}
	\varepsilon(\omega) = 1 + \widetilde{\chi}_1(\omega),
\end{equation}

где $\widetilde{\chi}_1(\omega)$ это преобразование Фурье $\chi_1(t)$. Его действительная и мнимая части связаны с показателями преломления $n(\omega)$ и поглощения $\alpha(\omega)$ как:

\begin{equation}
	\varepsilon = \left( n + \frac{i \alpha c}{2\omega} \right) ^2
\end{equation}

\begin{equation}
	n(\omega) = 1 + \frac{1}{2} \Ree \left[ \widetilde{\chi}_1(\omega) \right]
\end{equation}

\begin{equation}
	\alpha(\omega) = \frac{\omega}{nc} \Imm \left[ \widetilde{\chi}_1(\omega) \right]
\end{equation}

Сделаем ещё два допущения~\cite{agrawal2007nonlinear}:

a. Из-за низких потерь в оптических волокнах в рассматриваемой области длин волн мнимая часть $\varepsilon(\omega)$ на порядки меньше действительной части. Так что мы можем заменить $\varepsilon(\omega)$ на $n^2(\omega)$

b. Поскольку $n(\omega)$ зачастую независимо от пространственных координат как в сердцевине, так и в оболочке ступенчатых волокон, мы имеем ($\divg \mathbf{D} = \varepsilon \divg \mathbf{E} = 0$)

\begin{equation}
	\rot{\left( \rot \mathbf{E} \right)} = \rot{\left( \divg \mathbf{E} \right)} - \Delta \mathbf{E} = - \Delta \mathbf{E}
\end{equation}

Тогда уравнение (3.11) принимает вид волнового уравнения (Гельмгольца):

\begin{equation}
	\Delta \widetilde{\mathbf{E}}(\mathbf{r}, \omega) + n^2(\omega) \frac{\omega^2}{c^2} \widetilde{\mathbf{E}}(\mathbf{r}, \omega) = 0
\end{equation}

\begin{equation}
	\Delta \widetilde{\mathbf{H}}(\mathbf{r}, \omega) + n^2(\omega) \frac{\omega^2}{c^2} \widetilde{\mathbf{H}}(\mathbf{r}, \omega) = 0
\end{equation}

\section{Оптические моды}

В силу цилиндрической симметрии волокна, перепишем волновое уравнение (3.18) для цилиндрических координат $\rho$, $\varphi$, $z$ ($k_0 = \omega / c = 2\pi / \lambda$):

\begin{equation}
	\frac{\partial^2 \widetilde{\mathbf{E}}}{\partial \rho^2} + \frac{1}{\rho} \frac{\partial \widetilde{\mathbf{E}}}{\partial \rho} + \frac{1}{\rho^2} \frac{\partial^2 \widetilde{\mathbf{E}}}{\partial \varphi^2} + \frac{\partial^2 \widetilde{\mathbf{E}}}{\partial z^2} + n^2k_0^2\widetilde{\mathbf{E}} = 0
\end{equation}

Поля $\mathbf{E}$ и $\mathbf{H}$ удовлетворяют уравнениям Максвелла (3.1-3.4), так что две координаты из шести независимы.
Выберем таковыми $\widetilde{E}_z$ и $\widetilde{H}_z$, вдоль оси $z$ свет будет распространяться по оптоволокну.
Решаем волновое уравнение для $\widetilde{E}_z$ методом разделяющихся переменных~\cite{diament1990wave  }:

\begin{equation}
	\widetilde{E}_z(r, \omega) = F(\rho)\exp{(im\varphi)}\exp{(i\beta z)},
\end{equation}

здесь амплитуда света $A(\omega)$ зависит только от частоты $\omega$, $\beta$ -- постоянная распространения, $m$ -- целое число (оно появится позже) и функция поперечного распространения (то, что мы назовём модой) $F(\rho)$ находится из уравнения

\begin{equation}
	\frac{d^2 F}{d \rho^2} + \frac{1}{\rho}\frac{dF}{d\rho} + \left( n^2k_0^2 - \beta^2 - \frac{m^2}{\rho^2} \right)F = 0
\end{equation}

Это хорошо известное уравнение для функций Бесселя, общее решение которого $F$ может быть записано как~\cite{watson1995treatise}

\begin{equation}
	F(\rho) = c_1 J_m(p\rho) + c_2 N_m(p\rho),
\end{equation}

где $J_m$ -- функция Бесселя 1-го рода, а $N_m$ -- функция Нейманна, которая имеет разрыв в точке $\rho=0$, так что мы положим $c_2=0$ для физического смысла. Постоянная $c_1$ будет учтена в амплитуде $A(\omega)$. Тогда:

\begin{equation}
	F(\rho) = J_m(p\rho), \,\,\, p^2 = n_1^2k_0^2-\beta^2, \,\,\, \rho \leq R
\end{equation}

На поверхности оболочки решение $F(\rho)$ должно экспоненциально убывать с ростом $\rho$. Это учитывается функцией Бесселя 2-го рода $K_m$:

\begin{equation}
	F(\rho) = K_m(q\rho), \,\,\, q^2 = \beta^2-n_2^2k_0^2, \,\,\, \rho > R
\end{equation}

В итоге решения $\widetilde{E}_z$ и $\widetilde{H}_z$ будут иметь вид:

\begin{equation}
	\widetilde{E}_z(\rho, \varphi, z) =
	\begin{cases}
		A J_m(p\rho)\exp{(im\varphi)}\exp{(i\beta z)}, & \text{if $\rho \leq a$} \\
		C K_m(p\rho)\exp{(im\varphi)}\exp{(i\beta z)}, & \text{if $\rho > a$}
	\end{cases}
\end{equation}

\begin{equation}
	\widetilde{H}_z(\rho, \varphi, z) =
	\begin{cases}
		B J_m(p\rho)\exp{(im\varphi)}\exp{(i\beta z)}, & \text{if $\rho \leq a$} \\
		D K_m(p\rho)\exp{(im\varphi)}\exp{(i\beta z)}, & \text{if $\rho > a$}
	\end{cases}
\end{equation}

Используя уравнения Максвелла, выведем соотношения компонент внутри сердцевины волокна~\cite{snyder1983optical}:

\begin{equation}
	\widetilde{E}_{\rho} = \frac{i}{p^2} \left( \beta \frac{\partial E_z}{\partial \rho} + \mu_0 \frac{\omega}{\rho} \frac{\partial H_z}{\partial \varphi} \right)
\end{equation}

\begin{equation}
	\widetilde{E}_{\varphi} = \frac{i}{p^2} \left( \frac{\beta}{\rho} \frac{\partial E_z}{\partial \varphi} - \mu_0 \omega \frac{\partial H_z}{\partial \rho} \right)
\end{equation}

\begin{equation}
	\widetilde{H}_{\rho} = \frac{i}{p^2} \left( \beta \frac{\partial H_z}{\partial \rho} - \varepsilon_0 n^2 \frac{\omega}{\rho} \frac{\partial E_z}{\partial \varphi} \right)
\end{equation}

\begin{equation}
	\widetilde{H}_{\varphi} = \frac{i}{p^2} \left( \frac{\beta}{\rho} \frac{\partial H_z}{\partial \varphi} + \varepsilon_0 n^2 \omega \frac{\partial E_z}{\partial \rho} \right)
\end{equation}

Аналогичные уравнение будут в зоне оболочки можно получить после замены $p^2$ на $-q^2$.
Нам необходима непрерывность полей $\mathbf{\widetilde{E}}$ и $\mathbf{\widetilde{H}}$ на месте стыка сердцевины и оболочки (условие $\rho = a$), которая достигается равенством формул для них при $\rho \to a^-$ и $\rho \to a^+$.

Все нужные алгебраические преобразования проделаны, например, в книге~\cite{buck2004fundamentals} -- в итоге имеем характеристическое уравнение:

\begin{equation}
	\begin{cases}
		\xi = {J'_m(pa)}/{pJ_m(pa)}  \\
		\eta = {K'_m(qa)}/{qK_m(qa)} \\
		\kappa = {n_2^2}/{n_1^2}     \\
		\left( \xi + \eta \right) \left( \xi + \kappa \eta \right) = \left( {m \beta k_0 (n_1^2-n_2^2)}/{an_1p^2q^2} \right)^2
	\end{cases}
\end{equation}

Вообще говоря, это уравнение имеет несколько решений $\beta$ для разных целых значений $m$, что обуславливает существование нескольких мод.
Введём параметр нормализованной частоты $V = k_0 a \sqrt{n_1^2-n_2^2} = 2 \pi a \sqrt{n_1^2-n_2^2} / \lambda$

Характеристическое уравнение позволяет определять такие значения $V$, при которых существуют различные моды распространения света~\cite{agrawal2007nonlinear, marcuse1991theory}.
Поскольку мы рассматриваем одномодовое оптоволокно, то ограничимся рассмотрением условия для возникновения только одной, так же называемой фундаментальной, моды.
Остальные моды не возникают, если параметр $V<V_c$, где $V_c$ это наименьший корень уравнения $J_0(V_c)=0$, так что $V_c \approx 2.405$~\cite{agrawal2007nonlinear}.
Нужная длина волны $\lambda_c$ для одномодового волокна может быть получена подстановкой $k_0=2\pi/\lambda_c$ и $V=2.405$ в связывающее их уравнение.
На практике обычно разность показателей преломления равна $n_1-n_2 \approx 0.005$, так что длина волны $\lambda_c = 1.2$ мкм при радиусе оптоволокна $a=4$ мкм.

Соответственно, нам нужна длина волны $\lambda > 1.2$ мкм.

Формула для электрического поля, распространяющегося вдоль оси $z$ и поляризованного вдоль оси $\mathbf{x}$ примерно равна:

\begin{equation}
	\mathbf{\widetilde{E}}{(\mathbf{r}, \omega)} = A(\omega) F(x, y) \exp{(i \beta(\omega) z )} \mathbf{x}
\end{equation}

Тогда поперечное распределение фундаментальной моды в сердцевине~\cite{marcuse1991theory}:

\begin{equation}
	F(x, y) = J_0(p\rho), \,\,\, \rho < a,
\end{equation}

где $\rho = \sqrt{x^2+y^2}$ -- радиус волокна, а на оболочке:

\begin{equation}
	F(x, y) = \sqrt{a/\rho} J_0(pa) \exp{(-q(\rho-a))}, \,\,\, \rho \geq a.
\end{equation}

Тогда постоянная распространения $\beta(\omega)$ может быть найдена из характеристического уравнения (обычно это численные методы, как показано в~\cite{marcuse1991theory})

Введём эффективный показатель преломления моды как $n_eff = \beta / k_0$.

На практике хорошо себя показало гауссово приближение распространения фундаментальной моды $F(x, y)$:

\begin{equation}
	F(x, y) \approx \exp{-(x^2+y^2)/w^2},
\end{equation}

где параметр ширины $w$ определяется аппроксимацией кривой распределения поля или с помощью вариационных методов~\cite{agrawal2007nonlinear}.
В статье~\cite{Marcuse:78} показано, что такое приближение отлично работает на практике, особенно когда параметр $V$ не сильно больше $2$.

\begin{figure*}[t]
	\centering
	\includegraphics[width=300pt]{v-2-4.png}
	\caption{Изменения параметра $\omega$ в зависимости от коэффициента $V$.}
	\label{fig:block_diagram}
\end{figure*}

В частности, в статье~\cite{Marcuse:78} получили приближённое значение $w$ с точностью до $1\%$ для $1.2 < V < 2.4$:

$$w/a \approx 0.65 + 1.619V^{-3/2} + 2.879V^{-6}$$

Добавим ещё несколько общих слов про параметр $V>2.405$. Если увеличивать диаметр сердцевины оптоволокна или разность коэффициентов преломления $n_1 - n_2$ (например, экономить на прозрачности оболочки), то $V$-число возрастёт, а соответственно возрастаёт и количество мод.
Почему это плохо? Из-за того, что у каждой моды своя постоянная распространения $\beta_{mn}$ (фактически мы имеем разные траектории распространения света по волноводу), то у них будут разные времена попадания на приёмник (RX-устройство) -- получаем расширение светового импульса, что приводит к ограничению полосы пропускания и дальность сигнала без ретрансляции.

Формула для оценки межмодовой дисперсии в простейшем случае выглядит так~\cite{agrawal2007nonlinear}:

\begin{equation}
	\Delta \tau = \frac{L}{c} \cdot \frac{n_1 - n_2}{n_2},
\end{equation}

где $L$ -- длина трассы и $c$ -- скорость светового сигнала. Чем больше разница $n_1 - n_2$, тем больше значение дисперсии.

\section{Уравнение распространения импульса}

Используя уравнения выше, несложно вывести следующее уравнение с линейной и нелинейной частями поляризации $P_L$ и $P_{NL}$:

\begin{equation}
	\Delta E - \frac{1}{c^2}\frac{\partial^2 E}{\partial t^2} = \mu_0 \frac{\partial^2 P_L}{\partial t^2} + \mu_0 \frac{\partial^2 P_{NL}}{\partial t^2}
\end{equation}

Теперь примем во внимание следующие соображения:

a. Как уже было сказано выше, нелинейная поляризация $\mathbf{P}_{NL}$ гораздо меньше чем линейная $\mathbf{P}_{L}$

b. Как показывает практика, поляризация на каждом участке оптического волокна сохраняется (в том числе и на очень больших дистанциях), что делаем применимым её скалярное представление

c. Оптический сигнал мы полагаем монохроматическим, то есть световой импульс собран (по Гауссу) вокруг частоты $\omega_0$ и ширина его спектра $\Delta \omega$ очень невелика: $\Delta \omega / \omega_0 << 1$

Выделим наиболее быстро осциллирующую часть электрического поля~\cite{agrawal2007nonlinear}:

\begin{equation}
	\mathbf{E}(\mathbf{r}, t) = \frac{1}{2}\mathbf{x}\left( E(\mathbf{r}, t) + \text{c.c.} \right),
\end{equation}

где $\mathbf{x}$ -- орт поляризации и $E(\mathbf{r}, t)$ -- медленно меняющаяся во времени функция. Аналогично:

\begin{equation}
	\mathbf{P}_L(\mathbf{r}, t) = \frac{1}{2}\mathbf{x}\left( P_L(\mathbf{r}, t) + \text{c.c.} \right),
\end{equation}

\begin{equation}
	\mathbf{P}_{NL}(\mathbf{r}, t) = \frac{1}{2}\mathbf{x}\left( P_{NL}(\mathbf{r}, t) + \text{c.c.} \right),
\end{equation}

Как показано в монографии~\cite{agrawal2007nonlinear}, значения скалярных коэффициентов $P_L$ и $P_{NL}$ могут быть вычислены как:

\begin{equation}
	P_L(\mathbf{r}, t) \approx \frac{\varepsilon_0}{2\pi} \int \limits_{-\infty}^{+\infty} \chi_{1xx}(\omega) \widetilde{E}(\mathbf{r}, \omega - \omega_0) \exp{\left( -i(\omega - \omega_0) \right)} \, d\omega
\end{equation}

\begin{equation}
	P_{NL}(\mathbf{r}, t) \approx \varepsilon_0 \varepsilon_{NL} E(\mathbf{r}, t),
\end{equation}

где нелинейный вклад в электрическую постоянную равен

\begin{equation}
	\varepsilon_{NL}(\mathbf{r}, t) = 3/4 \chi_{3xxxx} \left| E(\mathbf{r}, t) \right|^2
\end{equation}

Волновое уравнение с учётом нелинейной поляризации примет вид:

\begin{equation}
	\Delta \widetilde{E} + \varepsilon(\omega) k_0^2 \widetilde{E} = 0,
\end{equation}

где $k_0 = \omega / c$ и

\begin{equation}
	\varepsilon(\omega) = 1 + \widetilde{\chi}_{1xx} + \varepsilon_{NL}
\end{equation}

Решая, по аналогии с предыдущей главой, волновое уравнение для нелинейно поляризованного света, имеем решение посредством метода разделяющихся переменных:

\begin{equation}
	\mathbf{E}(\mathbf{r}, t) = \frac{1}{2}\mathbf{x}\left( F(x, y) A(z, t) \exp{(i(\beta_0z - \omega_0t)} + \text{c.c.} \right)
\end{equation}

\begin{equation}
	\frac{\partial A}{\partial z} + \beta_1 \frac{\partial A}{\partial t} + \frac{i \beta_2}{2} \frac{\partial^2 A}{\partial t^2} = i \Delta \beta_0 A
\end{equation}

\begin{equation}
	\frac{\partial^2 F}{\partial x^2} + \frac{\partial^2 F}{\partial y^2} + \left( \varepsilon(\omega) k_0^2 - \widetilde{\beta}^2 \right) F = 0
\end{equation}

Согласно~\cite{agrawal2007nonlinear}, после нескольких преобразований условия на $A$, мы получим уравнение:

\begin{equation}
	\frac{\partial A}{\partial z} + \beta_1 \frac{\partial A}{\partial t} + \frac{i\beta_2}{2} \frac{\partial^2 A}{\partial t^2} + \frac{\alpha}{2} A = i\gamma(\omega_0)|A|^2 A,
\end{equation}

где нелинейный параметр $\gamma$ определяется как:

\begin{equation}
	\gamma(\omega_0) = \frac{\omega_0 n_2}{c A_{\text{eff}}}, \text{ и }
\end{equation}

\begin{equation}
	A_{\text{eff}} = \frac{\left(\iint_{-\infty}^{\infty} |F(x,y)|^2 dx\,dy \right)^2}{\iint_{-\infty}^{\infty} |F(x,y)|^4 dx\,dy}
\end{equation}

Данное уравнение описывает распространение оптического импульса в SMF.
Оно включает затухание импульса (параметр $\alpha$), GVD ($\beta_1$ и $\beta_2$) и нелинейный эффект Керра (параметр $\gamma$).
Численное значение $\gamma$ требует знание распределения фундаментальной моды $F(x, y)$, в силу формулы $A_{\text{eff}}$.
В частности, оно может быть сведено к NLSE умножением на мнимую единицу $i$ и отбрасыванием малого коэффициента $\beta_1$, обратно пропорционального групповой скорости импульса~\cite{agrawal2007nonlinear}:

\begin{equation}
	i \frac{\partial A}{\partial z} + \frac{i \alpha}{2} A - \frac{\beta_2}{2}\frac{\partial^2 A}{\partial t^2} + \gamma \left| A \right|^2 A = 0
\end{equation}

Аналитического решения NLSE в общем случае до сих пор не найдено~\cite{sasai2021physics, ARORA2022169661}, поэтому мы рассмотрим два наиболее распространённых семейства численных подходов.
Один из них опирается на результаты теории возмущений (PBM методы), а другой -- на псевдоспектральный подход (SSFM, метод расщепления по Фурье)

\section{Асимметричный SSFM}

Наиболее точным численным подходом к решению NLSE сейчас является метод Фурье расщепления по физическим процессам (SSFM, split-step Fourier method)~\cite{ARORA2022169661, agrawal2007nonlinear}.
Перепишем NLSE как комбинацию линейного и нелинейного дифференциальных операторов:

\begin{equation}
	\frac{\partial A}{\partial z} = (\hat{D} + \hat{N}) A
\end{equation}

Здесь оператор $\hat{D}$ отвечает за дисперсию и затухание, а $\hat{N}$ -- за нелинейные эффекты, возникающие в оптических волокнах:

\begin{equation}
	\hat{D} = -\frac{i \beta_2}{2} \frac{\partial^2}{\partial T^2} - \frac{\alpha}{2}
\end{equation}

\begin{equation}
	\hat{N} = i \gamma |A|^2
\end{equation}

В целом, дисперсия и нелинейный эффект действуют вместе на всем участке волокна. Метод SSFM предлагает решение, основанное на следующем приближении: на очень малом участке длины $h$ дисперсия и нелинейный эффект действуют независимо друг от друга.
Распространение света от координаты $z$ до координаты $z+h$ осуществляется в два шага: сначала действует нелинейный эффект и $\hat{D}=0$, а затем -- линейные эффекты и $\hat{N}=0$.
Математически это запишется так:

\begin{equation}
	A(z + h, T) \approx \exp{(h\hat{D})} \exp{(h\hat{N})} A(z, T)
\end{equation}

Сравним это приближение с формальным решением:

\begin{equation}
	A(z + h, T) = \exp{\left( \hat{D} + \hat{N} \right)} A(z, T),
\end{equation}

где $\hat{N}$ считаем $z$-независимым оператором. Произведение экспонент двух некоммутирующих операторов запишется как~\cite{agrawal2007nonlinear}:

\begin{equation}
	\exp{(A)} \exp{(B)} = \exp{\left( A + B + \frac{1}{2}\left[ A, B \right] + \frac{1}{12} \left[ A - B, \left[ A, B \right] \right] \right)},
\end{equation}

где векторное произведение выражается как: $\left[ A, B \right] = AB - BA$. Таким образом, метод SSFM игнорирует некоммутативную природу двух данных операторов.
Полагая $A = h\hat{D}$ и $B = h\hat{N}$ ошибка будет составлять $1/2 h^2 \left[ \hat{D}, \hat{N} \right]$. Так что погрешность эквивалентна квадрату шага $h$.

Заметим, что погрешность можно уменьшить ещё сильнее, если приближать $A(z, t)$ следующим образом~\cite{agrawal2007nonlinear}:

\begin{equation}
	A(z + h, T) \approx \exp{\left( \frac{h}{2} \hat{D} \right)} \exp{\left( \int \limits_{z}^{z+h} \hat{N}(z')dz' \right)} \exp{\left( \frac{h}{2} \hat{D} \right)} A(z, T)
\end{equation}

Разумеется, интеграл можно приблизить так:

\begin{equation}
	\int \limits_{z}^{z+h} \hat{N}(z')dz' \approx \frac{h}{2} \left( \hat{N}(z) + \hat{N}(z + h) \right)
\end{equation}

Однако на практике обычно пользуются таким приближением (в силу более простой реализации, что помогает внедрять алгоритм в чип)~\cite{Sinkin2003}:

\begin{equation}
	A(L, T) \approx \text{e}^{-\frac{1}{2}h\hat{D}} \left( \prod \limits_{m=1}^M \text{e}^{h\hat{D}} \text{e}^{h\hat{N}} \right) \text{e}^{\frac{1}{2}h\hat{D}} A(0, T),
\end{equation}

где $L = Mh$ -- это длина всего всего волокна; интеграл был приближен $h\hat{N}$.
Метод SSFM является ядром алгоритма компенсации искажений в оптическом волокне -- цифрового обратного распространения (digital back-propogation, DBP)~\cite{dbp4738549}.
Для DBP берутся коэффициенты с противоположными знаками.

Теперь приступим к практической реализации SSFM метода~\cite{hager2020}.

Для этого предположим, что сигналы $x(t)$ и $y(t)$ дискретизируются в моменты времени $t=k/f_s$ ($f_s$ -- выбранная частота дискретизации),
что даёт нам последовательности отсчётов $\left\{ x_k \right\}_{k \in \mathbb{Z}}$ и $\left\{ y_k \right\}_{k \in \mathbb{Z}}$.
Имеем дискретизированное по времени NLSE:

\begin{equation}
	\frac{d \mathbf{u}(z)}{dz} = -\frac{\alpha}{2} \mathbf{u}(z) + \mathbf{A} \mathbf{u}(z) + i \gamma \mathbf{\rho} (\mathbf{u}(z)),
\end{equation}

где $\mathbf{A} = \mathbf{F}^{-1} \text{diag}(H_1, \ldots, H_n) \mathbf{F}$, $\mathbf{F}$ это матрица дискретного преобразования Фурье (DFT),
$H_k = i\beta_2\omega_k^2/2$, $\omega_k = 2\pi f_k$ это $k$-я угловая частота DFT, а $\mathbf{\rho}: \mathbb{C}^n \to \mathbb{C}^n$ это поэлементное умножение на квадрат нормы: $\rho(x)=x|x|^2$.
Имеем обыкновенное дифференциальное уравнение 1-го порядка для векторзначной функции $\mathbf{u}(z)$ с условием Коши $\mathbf{u}(0)=\mathbf{x}$.
Далее волокно разбивается на $M$ участков $\delta_1, \ldots, \delta_M$ таких что, их сумма равна $L$.
Если нелинейный параметр $\gamma=0$, то уравнение становится линейным с решением $\mathbf{u}(z)=\mathbf{A}_z\mathbf{u}_0$, где $\mathbf{A}_z = \text{e}^{-\alpha/2}\text{e}^{z\mathbf{A}}$ и оператор $\text{e}^{z\mathbf{A}}=\mathbf{F}^{-1}\text{diag}(\text{e}^{zH_1},\ldots,\text{e}^{zH_n})\mathbf{F}$
Если $\alpha=\beta_2=0$, то нелинейное уравнение имеет решение $\mathbf{u}(z)=\mathbf{\sigma}_z(\mathbf{u}_0)$, где $\mathbf{\sigma}_z: \mathbb{C}^n \to \mathbb{C}^n$ это поэлементное умножение $\sigma_z(x)=x\text{e}^{i\gamma z|x|^2}$.
Попеременное применение двух этих операторов даст для $z=\delta_i$:

\begin{equation}
	\mathbf{u}_i = \mathbf{\sigma}_{\delta_i} \left( \mathbf{A}_{\delta_i} \mathbf{u}_{i-1} \right)
\end{equation}

Блок-схема для $\delta_1=\ldots=\delta_M=\delta$ показана в верхней части Рисунка 3.3.

\begin{figure}[!h]
	\begin{center}
		\includegraphics[width=300pt]{ssfm.png}
		\caption{Блок-схема SSFM (верх) и NN (низ)}
		\label{nmp}
	\end{center}
\end{figure}

\section{Нейронные сети}

Глубокая полносвязная нейронная сеть прямого распространения (feed-forward NN),
содержащая $l$ слоёв, определяет параметризованное отображение $y = f_{\theta}(x)$,
при котором входной вектор $x \in X$ преобразуется в выходной вектор $y \in Y$ посредством
последовательности аффинных преобразований и поэлементных нелинейностей~\cite{lecun2015deep, goodfellow2016deep, nielsen2015neural}.
Здесь $\theta$ — вектор параметров, а $X$ и $Y$ обозначают соответственно входное и выходное пространства.
Аффинные преобразования задаются соотношениями:

\begin{equation}
	\widetilde{x}_i = W_i x_{i-1} + b_i, \,\,\, i=1, 2, \ldots, l
\end{equation}

где $x_0$ определяется как $x$ -- вход первого слоя, $W_i$ -- матрица весов, $b_i$ -- вектор смещения.
Нелинейные преобразования определяются таким образом~\cite{goodfellow2016deep}:

\begin{equation}
	x_i = \sigma(\widetilde{x}_i),
\end{equation}

где $\sigma$ означает поэлементное применение некоторой нелинейной функции активации $\sigma$.
Типичными вариантами функции активации являются~\cite{goodfellow2016deep} $\sigma(z) = \text{max} \left\{ 0, z \right\}$, $\sigma(z) = \tanh(z)$ и $\sigma(z) = 1 / (1 + \text{e}^{-z})$
Структурная схема, иллюстрирующая полное отображение, реализуемое NN, показана в нижней части рисунка ниже.

Вектор параметров $\theta$ инкапсулирует все элементы матриц весов и векторов смещения: $\theta = \left\{ W_1, \ldots, W_m, b_1, \ldots, b_m \right\}$.
Нейронные сети являются универсальными аппроксиматорами функций в том смысле, что они могут приблизить любую желаемую функцию сколь угодно точно при должном выборе параметров $\theta$ и достаточно большой архитектуре сети~\cite{HORNIK1989359}.

Из сопоставления в верхней и нижней частях Рисунка 3.3 очевидно, что SSFM по существу имеет ту же функциональную форму, что и
глубокая полносвязная нейронная сеть прямого распространения (NN);
в обоих случаях происходит чередование аффинных шагов и простых поэлементных нелинейностей.
Основная идея алгоритма LDBP (Learned DBP) заключается в использовании этого наблюдения~\cite{Raissi2019}.

Данная в предыдущей главе параметризация SSM напрямую вдохновлена функциональной формой NN.
В частности, вместо использования матрицы $\mathbf{A}$ на каждом из $M$ шагов обычно все линейные шаги параметризуются~\cite{hager2020},
предполагая использование общих матриц $\mathbf{A}^{(1)}, \dots, \mathbf{A}^{(l)} \in \mathbb{C}^{n \times n}$, подобно матрицам весов в NN,
где $l = M$ обозначает количество шагов модели (или слоев).
Комбинируя параметризованные линейные шаги со стандартными нелинейностями SSM, получаем параметризованную версию SSM в виде

\begin{equation}
	\mathbf{f}_{\theta}(\mathbf{x}) = \mathbf{\sigma}_l(\mathbf{A}^{(l)}\ldots\mathbf{\sigma}_1(\mathbf{A}^{(1)}\mathbf{x})),
\end{equation}

где вектор $\theta = \left\{ \mathbf{A}^{(1)}, \dots, \mathbf{A}^{(l)} \right\}$ объединяет все настраиваемые параметры и $\mathbf{\sigma}_i = \mathbf{\sigma}_{\delta_i}$

Указанная выше параметризация имеет недостаток: количество параметров растет квадратично с длиной блока $n$.
Более практичная параметризация достигается путем ограничения каждой матрицы $\mathbf{A}^{(i)}$ эквивалентной свёрткой с фильтром FIR (с конечной импульсной характеристикой)~\cite{hager2020}
В этом случае все строки матрицы являются циклически сдвинутыми версиями вектора $\left( h_{K_i}^{(i)}, \ldots, h_{1}^{(i)}, h_{0}^{(i)}, h_{1}^{(i)}, \ldots, h_{K_i}^{(i)}, 0, \ldots, 0 \right)$.
Здесь $h_j^{(i)} \in \mathbb{C}$, $j=-K_i, \ldots, K_i$ это коэффициенты FIR фильтра и $T_i = 2K_i + 1$ -- его длина.

После объединения всех настраиваемых коэффициентов в вектор $\mathbf{h}^{(i)} = (h^{(i)}{0}, h^{(i)}{1}, \dots, h^{(i)}_{K_i})$,
новый вектор параметров для всей модели становится $\theta = {\mathbf{h}^{(1)}, \dots, \mathbf{h}^{(M)}}$.
Это сокращает количество вещественных параметров на одну матрицу весов с $2 n^2$ до $2 (K_i + 1)$, где обычно $K_i \ll n$.
Пример получившейся DSP структуры для $l=2$ шагов и $T_1=5$ и $T_2=3$ показан на Рисунке 3.4.

\begin{figure}[!h]
	\begin{center}
		\includegraphics[width=300pt]{dsp-fir.png}
		\caption{DSP структура с FIR фильтрами. Треугольник это нелинейный шаг.}
		\label{nmp}
	\end{center}
\end{figure}

\section{Обучение с учителем}

В постановке задачи обучения с учителем имеется обучающая выборка $S \subset X \times Y$, содержащая список пар <<вход–выход>>, которые неявно определяют желаемое отображение~\cite{goodfellow2016deep}.
Затем обучение проводится путём минимизации функции потерь $\mathcal{L}_S(\theta)$ на обучающей выборке, которая определяется как~\cite{nielsen2015neural}:

\begin{equation}
	\mathcal{L}_S(\theta) = \frac{1}{|A|} \sum \limits_{(x, y) \in S} l(f_{\theta}(x), y),
\end{equation}

где $l(\widetilde{y}, y)$ -- функция потерь на одном примере, связанная с тем, совпадают ли значения $\widetilde{y} = f_{\theta}(x)$ и $y$.
Когда обучающая выборка велика, вектор параметров $\theta$ обычно оптимизируется с использованием варианта стохастического градиентного спуска (SGD).
В частности, стандартный mini-batch SGD использует следующее правило обновления параметров:

\begin{equation}
	\theta_{t+1} = \theta_t - \mu \nabla L_{B_t} (\theta_t),
\end{equation}

где $\mu$ — скорость обучения (learning rate), а $B_t \subset S$ — мини-батч (подвыборка), используемый на $t$-м шаге.
Обычно $B_t$ выбирается как случайное подмножество $S$ некоторого фиксированного размера, который соответствует доступным вычислительным ресурсам, например, графическим процессорам (GPU)~\cite{hager2020}.

\section{Симметричный метод SSFM}

В данной главе будут обсуждаться другой вариант SSFM, исследованный в работах~\cite{agrawal2007nonlinear, hager2020}.
Численный метод, описанный в главе <<Асимметричный метод SSFM>>, на практике обычно не применяется -- вместо него используется симметричная версия,
уменьшающая ошибку аппроксимации с $\mathcal{O}(M^{-1})$ до $\mathcal{O}(M^{-2})$ без дополнительных затрат~\cite{agrawal2007nonlinear}.
Он определяется следующим образом:

\begin{equation}
	\mathbf{u}_i = \mathbf{A}_{\delta_i/2} \mathbf{\sigma}_{\delta_i} \left( \mathbf{A}_{\delta_i/2} \mathbf{u}_{i-1} \right), \,\,\, i = 1,2,\ldots,M
\end{equation}

Модель $\mathbf{f}_{\theta}$ может быть основана и на параметризации симметричной версии SSFM, как это показано в статьях~\cite{hager2018, pfister2021}.
Главное отличие в том, что коэффициент $l = M+1$ -- уменьшается в два раза.


\section{Алгоритм Learned DBP}

Learned DBP это метод нелинейной компенсации (equalization) на стороне приёмника (receiver-side digital backpropagation)~\cite{hager2018, hager2020}.
Особое внимание в разработке данного метода уделено низкосложной и эффективной аппаратной реализации в DSP чипе.
DBP использует тот факт, что при отсутствии шума переданный сигнал может быть восстановлен путём решения задачи Коши
(initial value problem, IVP) с использованием принятого сигнала в качестве начального условия~\cite{Pare1996}.
На практике принятый сигнал сначала проходит через аналого-цифровой преобразователь, после чего задачу Коши можно приближённо решить средствами DSP приёмника.

Параметризованный SSM, представленный в предыдущем разделе, и его оптимизация с использованием различных инструментов машинного обучения, называется обученным DBP (LDBP, learned DBP).
